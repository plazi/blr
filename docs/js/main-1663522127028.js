/* generated: Sun Sep 18 2022 19:28:47 GMT+0200 (Central European Summer Time) */
const e=e=>document.querySelector(e),t=e=>document.querySelectorAll(e),a=(e,t,a)=>{const s=document.createElement(e);if(t)for(let[e,a]of Object.entries(t))s.setAttribute(e,a);return a&&(s.innerHTML=a),s},s=t=>{(()=>{const t=a("div",{id:"controller",class:"tabs"}),s=a("input",{id:"years",name:"years",type:"range",step:1});t.append(s);const r=a("br");t.append(r);const n=a("label",{for:"years"},'Year <span id="yearsVal"></span>');t.append(n),e("#db-tiles").append(t);const i=a("div",{id:"tiles"});e("#db-tiles").append(i)})(),e("#years").addEventListener("input",(a=>(t=>{const a=Number(e("#years").value);e("#yearsVal").innerText=a,r(t)})(t))),(t=>{e("#years").min=Math.min(...t.categories),e("#years").max=Math.max(...t.categories),e("#years").value=t.categories[0],e("#yearsVal").innerText=t.categories[0]})(t),Object.keys(t.values).forEach((s=>((t,s)=>{const r=Number(e("#years").value),n=t.categories.indexOf(r);if(Array.isArray(t.values[s])){const r=t.values[s][n],i=a("div",{id:`tile-${s}`,class:"tile"},`${s}: ${r}`);e("#tiles").append(i)}})(t,s)))},r=t=>{Object.keys(t.values).forEach((a=>((t,a)=>{const s=Number(e("#years").value),r=t.categories.indexOf(s),n=t.values[a][r]||"";e(`#tile-${a}`).innerHTML=`${a}: ${n}`})(t,a)))},n=(e,t)=>{const a=e.values[t];if(Array.isArray(a))return{label:t,data:a,backgroundColor:"#c0c0c0",borderColor:"#444444",borderWidth:1}},i={},o=t=>{Object.keys(t.values).forEach((a=>{Array.isArray(t.values[a])&&((t,a)=>{const s={type:"bar",data:{labels:t.categories,datasets:[n(t,a)]},options:{indexAxis:"y",responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:a}}}},r=document.createElement("canvas");r.setAttribute("height",260);const o=document.createElement("li");o.setAttribute("class","slide"),o.append(r),e("#slides-container").append(o);const c=new Chart(r,s);i[a]=c})(t,a)})),c()},c=()=>{const t=e("#slides-container"),a=e(".slide");e("#slide-arrow-next").addEventListener("click",(e=>{const s=a.clientWidth;t.scrollLeft+=s})),e("#slide-arrow-prev").addEventListener("click",(e=>{const s=a.clientWidth;t.scrollLeft-=s}))},l=L.layerGroup();let d,p;const u=async(e,t)=>{const a=e.filter((e=>e.country));for(let e=0,t=a.length;e<t;e++){const t=a[e],s=p.features.filter((e=>e.properties.name===t.country))[0];if(s&&s.properties.center_lat){const e=[Number(s.properties.center_lat),Number(s.properties.center_lng)],a=Number(t.num),r=10*a,n=L.circle(e,{color:"red",fillColor:"#f03",fillOpacity:.35,weight:1,radius:r}).bindPopup(`<p class="loc-num">${t.country}: ${a}</p>`);l.addLayer(n)}}d.addLayer(l);const s=e.sort().filter((e=>e.country)).slice(0,10).map((e=>`<li>${e.country}: ${e.num}</li>`));t.innerHTML=`<ul><li><b>Top Ten</b></li>${s.join("")}</ul>`},m=t=>{s(t),o(t),(async t=>{const a=document.createElement("div");a.classList.add("db-map");const s=document.createElement("div");s.classList.add("map");const r=document.createElement("div");r.setAttribute("id","location-list"),r.classList.add("list"),a.append(s),a.append(r),e("#db-maps").append(a);const n=await fetch("data/world-countries.json",{cache:"force-cache"});p=await n.json(),d=L.map(s).setView([0,0],1),L.geoJSON(p,{style:e=>({fillColor:"lightgreen",weight:1,opacity:1,color:"green",fillOpacity:.35})}).addTo(d),u(t,r)})(t.locations)},h=t=>{var a,s;r(t),a=t,Object.keys(a.values).forEach((e=>{if(Array.isArray(a.values[e])){const t=i[e];t.data.labels=a.categories,t.data.datasets=[n(a,e)],t.update()}})),s=t.locations,l.clearLayers(),u(s,e("#location-list"))},f=a=>{const{count:s,records:r,_links:n}=a;if(s){e("#treatments").innerHTML=`Taxon Treatments ${s}`;const t=v(r);e("#results").innerHTML=t,s>30&&(e("#pager").innerHTML=g(n))}else e("#results").innerHTML="<p>Nothing found</p>";Array.from(t("form button")).filter((e=>"treatments"===e.id))[0].classList.remove("spinning")},y=e=>{const t=new URL(e);return t.searchParams.delete("stats"),t.searchParams.toString()},g=e=>`<a href="/index.html?${y(e._prev)}" class="page">prev</a> <a href="/index.html?${y(e._next)}" class="page">next</a>`,v=e=>e.map((e=>`<div class="record">\n<h2>${e.treatmentTitle}</h2>\n<p>${e.articleTitle}</p>\n<a href="${e.articleDOI}" class="doi">${e.articleDOI}</a><br>\n<a href="http://treatment.plazi.org/id/${e.treatmentId}" class="recBtn">Treatment Bank</a> <a href="https://zenodo.org/record/${e.zenodoDep}" class="recBtn">Zenodo</a>\n</div>`)).join("\n"),b=()=>{E(),$()},$=()=>{const t=window.location,a=t.pathname.split("/").pop().split(".")[0]||"index";w(a);let s="cols=",r="firstLoad";if(t.search){s=t.search.substring(1);const a=s.match(/q=(?<q>\w+)&?/);a.groups&&"q"in a.groups&&(e("#query_string").value=a.groups.q,r="bookmark")}T(s,r)},k=e=>{const t=e.target.href.substring(1);w(t)},E=()=>{t(".nav-link").forEach((e=>e.addEventListener("click",k))),t("form button").forEach((e=>e.addEventListener("click",x))),e("form").addEventListener("submit",x)},w=a=>{t("article").forEach((e=>e.classList.add("hidden"))),"index"===a?(e("#dashboard").classList.remove("hidden"),e("form").classList.remove("hidden")):(e("#dashboard").classList.add("hidden"),e("form").classList.add("hidden")),e(`#${a}`).classList.remove("hidden")},x=async a=>{a.stopPropagation(),a.preventDefault();const s=e("#query_string").value;if(!s)return e("#query_string").placeholder="Please enter a search term",void setTimeout((()=>e("#query_string").placeholder="Search"),2e3);const r=`${[...t("input[name=type]")].filter((e=>e.checked))[0].value}=${s}`;t("form button").forEach((e=>{e.classList.remove("active"),e.classList.add("inactive")})),a.target.classList.remove("inactive"),a.target.classList.add("spinning"),T(r,"go")},T=async(e,a)=>{const s=await(async e=>{const t=e;e+="&stats=true";const a="localhost"===window.location.hostname?"http://localhost:3010/v3":"https://test.zenodeo.org/v3",s=await fetch(`${a}/treatments?${e}`);if(s.ok){"/index.html"===window.location.pathname&&"cols="!==t&&history.pushState(null,null,`index.html?${t}`);const e=await s.json();return{count:e.item.result.count,records:e.item.result.records,stats:e.item.result.stats,_links:e.item._links}}alert("HTTP-Error: "+s.status)})(e);s.count?("firstLoad"!==a&&(f(s),t(".page").forEach((e=>e.addEventListener("click",O)))),"firstLoad"===a||"bookmark"===a?m(s.stats):"go"!==a&&"pagePage"!==a||h(s.stats)):f({count:0}),"bookmark"!==a&&A(e)},A=e=>{"cols="!==e&&history.pushState({},null,`?${e}`)},O=async e=>{e.stopPropagation(),e.preventDefault();const t=e.target.href.split("?")[1];T(t,"pagePage")};export{b as init};
