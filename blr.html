<!DOCTYPE html>
<html lang="en" id="html">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="The Biodiversity Literature Repository Explorer">
    <meta name="version" content="3.0">
    <meta name="author" content="Puneet Kishor">
    <meta name="copyright" content="CC0 Public Domain Dedication">
    
    <title>ocellus^3</title>
    
    <link rel="icon" type="image/png" href="img/ocellus.png">

    <link rel="stylesheet" href="Skeleton-2.0.4/css/normalize-7.0.0.min.css">
    <link rel="stylesheet" href="Skeleton-2.0.4/css/skeleton.min.css">
    <link rel="stylesheet" href="JavaScript-autoComplete/auto-complete.css">
    <link rel="stylesheet" href="fancysearch/fancysearch.css">
    <link rel="stylesheet" href="css/ocellus.css#uhydftr">
    <link rel="stylesheet" href="css/throbber.css">
</head>
<body>

<header>
    <div class="container">
        <div class="title">
            <a href="/" class="main-title">Ocellus<sup>3</sup></a>
        </div>              
        
        <div class="searchContainer">
            <nav><a href="">images</a><a href="">treatments</a><a href="">citations</a></nav>
            <div id="sSearch" class="searchWidget">
                <select name="communities">
                    <option selected>all communities</option>
                    <option>blr</option>
                    <option>icedig</option>
                </select>
                <div class="searchInputs">
                    <input id="q" type="text" required placeholder="search for something">
                    <input id="refreshCache" type="checkbox" name="refreshCache">
                </div>
                <button id="ssGo" class="searchButton">go</button>
            </div>
            <div id="fSearch" class="off-none"></div>
            <!-- <div class="searchChooser"><a id="searchChooser" href="">switch to fancy search</a></div> -->
            <div class="searchChooser">switch to fancy search</div>
        </div>
    </div>
</header>
<div id="fs-throbber" class="throbber throbber-off"></div>

<div class="container">
    <div class="row">
        <div class="twelve columns">
            <div id="refreshCacheWarning" class="u-cf off-none">This will refresh the cache; you probably don‘t want this.</div>

            <div id="about" class="off-none">
                <a id="about-close" class='about'>close</a>
                <div id="about-text" class="about">
                    <p>Ocellus is a frontend to the Biodiversity Literature Repository (BLR) with more than 180K images on <a href="https://zenodo.org" target="_blank">Zenodo</a>, 200K taxonomic treatments in <a href="http://treatmentbank.org" target="_blank">TreatmentBank</a>, and 800,000 citations on <a href="https://refbank.org" target="_blank">RefBank</a>. Ocellus depends on <a href="http://zenodeo.punkish.org" target="_blank">Zenodeo</a>, a <code>nodejs</code> API that queries, analyzes and aggregates results from these various repositories via a single, unified interface. Start typing in the search field and Ocellus will suggest from > 5100 taxonomic familes, or choose the fancy search interface to create more granular queries – Ocellus will retrieve the results for you.</p>
        
                    <p>For copyright information in the images, please consult the original record on Zenodo, BLR policies, and the applicable laws of your country. The half-fish in the footer is based on the original of a Blunt-Nosed Minnow, <i>Pimephales notatus</i> (Rafinesque) ♂ from the <a href="https://archive.org/stream/cu31924090292669/#page/n1063/mode/1up">Internet Archive</a> and has no known copyright restrictions. Please contact <a href="mailto:blr@plazi.org">Plazi</a> for more information or to provide feedback.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="twelve columns">
            <div id="wrapper"></div>
            <div id="carouselContainer" class="off-none">
                <div id="carousel"></div>
            </div>
        </div>
    </div>
</div>

<footer id="footer" class="fixed">
    <img src="img/fish.jpg">
</footer>

<!-- template for the masonry wall of images -->
<script id="templateMasonry" type="x-tmpl-mustache">
    <h3 id="numOfFoundRecords">{{numOfFoundRecords}} records found</h3>
    
    <div id="masonry" class="masonry">
        {{#figures}}
        <figure class='item'>
     
            <!-- 
            <div class="widget">
                <div id='status' class='status'></div>
                <button id="toggle-{{recId}}" class="report">r</button>
                <form>
                    <input type="text" class="imageReport" placeholder="enter report here">
                    <input type="hidden" name="recId" value="{{recId}}">
                    <button id="submit-{{recId}}" class="submit">send</button>
                    <button id="cancel-{{recId}}" class="cancel">cancel</button>
                </form>
            </div>
            -->
     
            <a><img src="{{imgA}}" data-recid="{{recId}}"></a>
            <!-- <a><img src="img/maratus.png" data-recid="{{recId}}"></a> -->
            <!-- <a href="javascript:Ocellus.carousel();"><img src="img/maratus.png"></a> -->
            <!-- <a href="#carousel" onclick="Ocellus.carousel(event);"><img src="{{imgA}}"></a> -->
            <figcaption class="transition-050 opacity85 text">
                <a class="transition-050">rec ID: {{recId}}</a>
                <div class="transition-050 desc">{{title}}. <a href='{{zenodoRecord}}' target='_blank'>more</a></div>
            </figcaption>
        </figure>
        {{/figures}}
    </div>
    
    {{#pager}}
    <div id="pager">
        ◀ <a href="{{prev}}" id="prev" class="pager">prev</a> 
        <a href="{{next}}" id="next" class="pager">next</a> ▶
    </div>
    {{/pager}}
</script>

<!-- template for the vertical carousel -->
<script id="templateCarousel" type="x-tmpl-mustache">    
    {{#figures}}
    <figure id="{{recId}}" class="image-wrapper">
        <div class="carouselOff">x</div>
        <a href="{{imageSrc}}" target="_blank">
            <img class="lazyload" src="{{imgA}}" data-src="{{imgC}}" alt="{{title}}" width="960" height="480"></a>
            <!-- <img class="lazyload" src="img/maratus-big.jpg" data-src="img/maratus-big.jpg" alt="{{title}}" width="960" height="480"></a> -->
        <figcaption>
            <a class="transition-050">rec ID: {{recId}}</a>
            <div class="transition-050 desc">{{title}}. <a href='{{zenodoRecord}}' target='_blank'>more</a></div>
        </figcaption>
    </figure>
    {{/figures}}
</script>

<script src="js/cookies.js"></script>
<script src="js/lazysizes.min.js"></script>
<script src="js/mustache.min.js"></script>
<script src="JavaScript-autoComplete/auto-complete.min.js"></script>
<script src="fancysearch/fancysearch.js"></script>
<script src="js/ocellus.js"></script>
<script src="js/facets.js"></script>

<script type="text/javascript">

    //const zenodeo = 'https://zenodeo.punkish.org';
    const zenodeo = 'http://localhost:3030';
    const facets = getFacets(zenodeo);

    window.onload = function() {

        //const searchChooser = document.querySelector('#searchChooser');
        const refreshCache = document.querySelector('#refreshCache');
        const refreshCacheWarning = document.querySelector('#refreshCacheWarning');
        
        const about = document.querySelector('#about');
        const aboutLink = document.querySelector('#about-close');
        const header = document.querySelector('header');
        const footer = document.querySelector('footer');
        const wrapper = document.querySelector('#wrapper');

        // load and compile the templates
        const templateMasonry = document.querySelector('#templateMasonry').innerHTML;
        const templateCarousel = document.querySelector('#templateCarousel').innerHTML;

        const select = document.querySelector('select');
        const q = document.querySelector('#q');
        const ssGo = document.querySelector('#ssGo');

        const throbber = document.querySelector('#fs-throbber');
        
        
        // const fsGo = document.querySelector('button[id=fs-go]');
        // const qField = document.querySelector('input[name=q]');
        // 
        // const carousel = document.querySelector('#carousel');
        // const carouselContainer = document.querySelector('#carouselContainer');
        // 
        // const footer = document.querySelector('footer');
        // const fsForm = document.querySelector('#fs-form');
        // 
        // const fsContainer = document.querySelector('#fs-container');
        // const searchChooser = document.querySelector('#searchChooser');
        // const sSearch = document.querySelector('#sSearch');
        // const fSearch = document.querySelector('#fSearch');

        
        
        Ocellus.init({

            // required to toggle refresh cache warning
            refreshCache: refreshCache,
            refreshCacheWarning: refreshCacheWarning,

            // required to toggle About
            about: about,
            aboutLink: aboutLink,
            header: header,
            footer: footer,
            wrapper: wrapper,

            // templates to be compiled and rendered
            // with data
            templateMasonry: templateMasonry,
            templateCarousel: templateCarousel,

            zenodeo: zenodeo,

            select: select,
            q: q,

            //searchChooser: searchChooser,

            ssGo: ssGo,
            throbber: throbber
            // qField: qField,
            // throbber: throbber,
            // carousel: carousel,
            // carouselContainer: carouselContainer,
            
            // sSearch: sSearch,
            // fSearch: fSearch
        });

        const fs = new fancySearch();
        const doSomethingWithQuery = function(query) {

            if (Object.keys(query).length) {
                throbber.classList.remove('throbber-off');
                throbber.classList.add('throbber-on');
                Ocellus.goGetIt({
                    query: query,
                    refreshCache: document.querySelector('#fs-refreshCache').checked
                });
            }
            else {

                const i = document.querySelectorAll('.fs-key-input')
                i[0].classList.add('warning');
                i[0].placeholder = 'Please choose a searchterm';
            }
        };

        // fs.init(
        //     document.getElementById('fSearch'), 
        //     // document.getElementById('fs-widget'), 
        //     facets,
        //     doSomethingWithQuery
        // );

        
        
        

        
        // 

        // Ocellus.initializeCommunities();
        // Ocellus.initializeSearch();
        // const select = document.querySelector('select[name="communities"');
        // select.addEventListener('mouseup', Ocellus.setCommunities);
    };
</script>
</body>
</html>